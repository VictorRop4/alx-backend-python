#!/bin/bash
# Script: kubctl-0x02
# Objective: Perform Blue-Green Deployment with zero downtime.

set -e

echo "ğŸš€ Deploying Blue version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Deploying Green version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ”— Applying Service (currently pointing to Blue)..."
kubectl apply -f kubeservice.yaml

echo "â³ Waiting for deployments to be ready..."
kubectl rollout status deployment/django-blue
kubectl rollout status deployment/django-green

echo "ğŸ“œ Checking logs of Green deployment for errors..."
GREEN_POD=$(kubectl get pods -l app=django,version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs "$GREEN_POD"

echo "âœ… Blue-Green deployments are running."
echo "âš¡ To switch traffic: edit kubeservice.yaml and set 'version: green' in selector, then re-apply:"
echo "   kubectl apply -f kubeservice.yaml"


